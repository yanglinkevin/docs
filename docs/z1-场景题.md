# 1. 转账，A转给B，先锁A后锁B，如果双方同时转账会发生什么？
- 死锁
    - 程序里：给所有资源编号，先拿小号的资源，才可以申请大号的资源。例如A对象的hashcode，以及B对象的hashcode，先锁小的，再锁大的。
    
    - 数据库里：
        - 1.数据库层面如果检测到死锁是会自动去回滚一个事务的
    - 避免死锁的方法 ，数据库层面
        - https://www.zhihu.com/question/268632336
        - 以固定的顺序访问，例如AB俩用户，肯定是有用户ID的，用这个ID大小设置加锁顺序。
        - 设置锁超时时间，锁超时了自动释放。
        - 对所使用的数据全部加锁，AB一次全部加上锁。
        - 设置锁优先级，低的先回滚。
# 2. 数据库如何解决死锁的？
- https://zhuanlan.zhihu.com/p/123096947 隔离级别与锁
- 那么，如何尽可能的避免死锁呢？
    - 1）以固定的顺序访问表和行。即按顺序申请锁，这样就不会造成互相等待的场面。

    - 2）大事务拆小。大事务更倾向于死锁，如果业务允许，将大事务拆小。

    - 3）在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁概率。

    - 4）降低隔离级别。如果业务允许，将隔离级别调低也是较好的选择，比如将隔离级别从RR调整为RC，可以避免掉很多因为gap锁造成的死锁。

    - 5）为表添加合理的索引。如果不走索引将会为表的每一行记录添加上锁，死锁的概率大大增大。